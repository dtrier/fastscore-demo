"# fastscore.schema.$in: tagged-double\n# fastscore.slot.1: unused\n# fastscore.module-attached: influxdb\n\nfrom influxdb import InfluxDBClient\nfrom datetime import datetime\nfrom time import sleep\n\ndef begin():\n    global influx, FLUSH_DELTA, BATCH_SIZE, BATCH\n    FLUSH_DELTA = 0.01\n    BATCH_SIZE = 10\n    BATCH = []\n    influx = InfluxDBClient('influxdb', '8086', 'admin', 'scorefast', 'fastscore')\n\ndef gen_point(name, value, timestamp):\n    point = {\n        \"measurement\": name,\n        \"time\": timestamp,\n        \"fields\": {\n            \"value\": value,\n            \"timestamp\": timestamp\n        }\n    }\n    return point\n\ndef action(datum):\n    global BATCH\n    name = datum['name']\n    value = datum['value']\n    timestamp = datetime.now().strftime('%Y-%m-%dT%H:%M:%SZ')\n\n    BATCH.append(gen_point(name, value, timestamp))\n\n    if BATCH_SIZE == len(BATCH):\n        influx.write_points(BATCH)\n        BATCH = []\n        sleep(FLUSH_DELTA)\n"